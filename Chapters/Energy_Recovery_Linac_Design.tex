%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
% Doctoral Thesis Template @ The University of Manchester
% LaTeX Chapter Template
% Version 1 (23/07/2020)
% Joe Crone
%
% This template is based on:
% The University of Manchester, Presentation of Thesis Policy
% Research Office Graduate Education Team
% June 2017
% http://www.regulations.manchester.ac.uk/pgr-presentation-theses/
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\documentclass[../main.tex]{subfiles}
\begin{document}

% Title
%--------------------------------------------------------
\chapter{Energy Recovery Linac Design}
\label{Energy_Recovery_Linac_Design} % to reference use \ref{ChapterTemplate}

\textcolor{blue}{**HYWEL SUGGESTS TO FOLLOW JAMES JONES THESIS, BUT WITH LESS DETAIL**}
\textcolor{blue}{https://www.research.manchester.ac.uk/portal/en/theses/design-of-a-novel-stacked-storage-ring-for-low-emittance-light-sources(53cedd16-ea4d-4343-abc9-78886a934a9b).html}


\section{Description of an Energy Recovery Linac}

\textcolor{blue}{**HOLZER'S TRASVERSE BEAM DYNAMICS A GOOD STARTING POINT**}

\textcolor{blue}{\begin{itemize}
    \item{Need to explain a photoinjector and an injector cryomodule}
    \item{Explain particle acceleration better}
    \item{Why is SRF currently preferred?
        \begin{itemize}
            \item{beam current considerations} 
        \end{itemize}}
    \item{single pass ERL}
    \item{multi-pass ERL}
    \item{transport options}
    \item{Dual linac ERLs
        \begin{itemize}
            \item{Asymmetry of linacs etc.}
            \item{what are the benefits?}
        \end{itemize}}
    \item{beam loading}
    \item{push-pull linacs}
\end{itemize}}

\subsection{Single Turn ERL}

Within this first order explanation of an energy recovery linac we consider, for simplicity, the case of a single turn electron ERL, with a single linac. Firstly, the electron bunches are injected typically by a high energy photoinjector and injector accelerator section to an electron beam kinetic energy of 5--10~\si{\mega\electronvolt} with a small emittance either operating in a burst mode, in which a train of bunches is injected with intermittent pauses, or in continuous wave (CW) mode where pulses are injected with a fixed bunch spacing. These particle bunches are then delivered in suitable configuration to a linac, a series of consecutive radio-frequency (RF) accelerating cavities, which accelerate the particle bunch via a generated electric field to some nominal energy. For an ERL either normal conducting RF (NCRF) or superconducting radio-frequency RF (SRF) accelerating cavities can be utilised. The accelerating electromagnetic field in an RF cavity produces a standing wave of wavelength $\lambda_{\mathrm{RF}}$ with a potential difference that is sinusoidally varying in position and time. Therefore, to accelerate the electron bunch it's transit of the cavity must coincide with near-peak voltage of the electric field.   

The particle bunch accelerated to nominal energy is then transported through a return beamline (return loop) consisting of a series of magnets which confine the electron bunch and return it to the linac. During transport the electron bunch could be utilised for a variety of applications, such as driving a light source, or for collider experiments as envisioned in Tigner's original design \cite{tigner1965possible}.

The electron bunch must have a path length of $\left(w+\frac{1}{2}\right)\lambda_{\mathrm{RF}}$, where $w$ is an integer, through the return beamline because this will determine that the electron bunch re-enters the linac at a trough in the potential difference ensuring the particle bunch is decelerated. The kinetic energy of the electron bunch is transferred to the electric field of the accelerating cavities within this deceleration and therefore recovered for acceleration of a subsequent bunch. The initial electron bunch is then transported to a beam stop.

When the energy imparted to the electron beam by an RF cavity is recovered by the identical RF cavity upon deceleration this is termed same cell energy recovery. Several different schemes can exist where energy imparted by a particular RF cavity is recovered by a different RF cavity or the energy used to accelerate an electron bunch is only partially recovered by an RF cavity. Schematics of energy recovery can be further complicated when there are multiple linac sections within an energy recovery linac and complexity is compounded when these are of asymmetric length.     

\subsection{Multi-pass ERL}

Multi-pass ERLs are a prominent subject within this manuscript, these operate differently from single turn ERLs as there are consecutive accelerating passes of the linac, as in a recirculating linac \cite{axel1977status}, followed by consecutive decelerating passes of the linac. In a multi-pass ERL the electron bunch is injected into the linac and is accelerated to the first nominal energy, then transported to the linac via a return beamline. However, we differ from a single turn ERL here as the return beamline must have a path length of $w\lambda_{\mathrm{RF}}$ in order for the electron bunch to coincide with the peak of the accelerating field and therefore be re-accelerated to the next nominal energy.

The acceleration can occur for an unbounded total of $\frac{m}{2}$ passes before the return beamline must conform to the $\left(w+\frac{1}{2}\right)\lambda_{\mathrm{RF}}$ path length condition; a phase change of 180\si{\degree} relative to the electromagnetic wave of the linac RF cavities which converts the electron bunch into a decelerating configuration. A series of $\frac{m}{2}$ decelerating passes then returns the bunch to its injection energy via a total of $m$ linac passes. The decelerating passes must have a path length obeying the $w\lambda_{\mathrm{RF}}$ condition as the bunch is already in the decelerating configuration and therefore must maintain a path length of integer RF wavelengths in order for the electron bunch to coincide with the troughs of the RF cavity electromagnetic wave. Once the electron bunch has returned to the injection energy it is transported to the beam stop. Each deceleration recovers energy for the subsequent electron bunch to be accelerated.        

Here we define the convention that an acceleration and later deceleration is termed a turn and that a single traversal of the linac is termed a pass, accelerating or otherwise. For example for a single linac two turn ERL, the electron bunch is accelerated by the linac twice, resulting in two nominal energies, then decelerated by the linac twice, however the electron bunch is returned to the linac only three times. An $n$ turn single linac ERL involves $m$ passes of the linac and requires $m-1$ traversals of a return beamline before the electron bunch is transported to the beam stop, corresponding to $n$ nominal energies of the ERL.   

\subsection{Multi-pass Electron Transport}

The requirement upon multi-pass ERLs to have multiple return beamlines which have to be in either accelerating or decelerating configuration and operate at several nominal energies enables a variety of solutions to beam transport. The simplest solution conceptually is to have a separate return transport for each individual pass, termed separate transport. This allows for independence in specification of each beamline, with both each nominal energy electron bunch having its own beamline and flexibility between accelerating and decelerating passes. However, separate transport means that $m-1$ beamlines must be configured to transport the electron beam from and to the linac which results in complicated spreader systems with challenging space considerations. Requiring multiple beamlines also increases cost of an ERL and in practice neighbouring beamlines can affect each other.

Within common transport, the accelerating and decelerating passes for each nominal energy that is traversed twice (i.e all but the maximum nominal energy) share a common return transport. This is possible since after the electron beam has been converted to the decelerating configuration on the maximum nominal energy pass (traversed only once) the path length condition $w\lambda_{\mathrm{RF}}$ is identical for the other nominal energies for accelerating and decelerating passes. However, the properties of the electron bunch do not remain invariant between accelerating and decelerating passes therefore the common transport return beamlines are doubly constrained. The advantage of this approach is that only $n$ transport beamlines are required, which reduces cost and the difficulty in design of spreader switch-yards where the beamlines feed into the entrance and exit of the linac.   
Another solution exists wherein multiple nominal energy electron beams in both accelerating and decelerating configuration are transported within the same beamline. To distinguish this from common transport we term this approach multi-energy common transport, This has been demonstrated \cite{bartnik2020cbeta} using a fixed field alternating gradient beamline. However, to operate a multi-pass ERL with a multi-energy common transport the matching constraints of this beamline are $m-1$ fold and the required phase change must be designed into the beamline. There is little room for error in this approach as correction or path length or optics has consequences for every other return pass. Hence, these are often utilised with a common transport spreader arrangement at the entrance and exit of the linac, though these are also highly constrained beamlines. The multi-energy common transport approach is advantageous as potentially only a single beamline need be afforded and theoretically, if all constraints can be satisfied, this avoids the need of a spreader system.  

\section{Fixed Field Alternating Gradient Beamlines}

\section{Collective Effects}

\subsection{Beam Breakup Instability}

The average beam current off energy recovery linacs can be seriously limited by the effects of the beam breakup instability (BBU). Average beam current limitations are challenging for inverse Compton scattering source development with ERL drivers because of the dependency of flux upon electron beam average current. Therefore, this collective effect has substantial consequences for the design of ERL driven ICS sources.

In the beam breakup instability, the electron bunch interacts with a higher order mode (HOM) of the accelerating structure and is subsequently deflected. Electron bunches with a transverse offset traverse an RF cavity and excite a HOM within the cavity. The electron bunch subsequently recieves a transverse kick, thereby generating a further higher order mode due to the transverse offset the kick generates. Beyond some threshold current value $I_{\mathrm{th}}$ this process becomes exponential in nature resulting in beam loss.

Two forms of beam breakup exist; cumulative BBU in which the instability builds up over a series of RF accelerating structures, for example a long (100's~\si{\meter}) linac, and regenerative BBU where the effect build up via multiple passes of the same RF cavity. The former of these was the observed first, with experimentation at SLAC \cite{panofsky1966electrons,altenmueller1966beam} and LLNL \cite{neil1970coherent} and analytically modelled by Panofsky and Bander et al \cite{panofsky1968asymptotic}. However, for ERLs -- especially multi-turn ERLs -- regenerative beam breakup instability is of greater concern due to the recirculated nature of the accelerator in which a short linac section is typical.

Regenerative BBU is particularly present in multi-turn ERLs in comparison to circular machines such as synchrotrons for several reasons for example, the multiple energy bunches in the ERL are deflected differently for the same HOM voltage causing variation in bunch transverse offsets and the change in revolution time for the first decelerating bunch in which the phase is modulated by 180\si{\degree} \cite{setiniyaz2021filling}.

Theoretical studies of regenerative BBU in ERL's were conducted by Hoffstaetter and Bazarov \cite{hoffstaetter2004beam} for uncoupled optics, then furthered for the case of coupled optics \cite{hoffstaetter2007recirculating}. The focus here is typically on the excitation of dipole higher order modes \textcolor{blue}{Why?} Experimentally, regenerative BBU was observed and studied in an ERL at the Jefferson Laboratory FEL \cite{tennant2005first,douglas2006experimental}. \textcolor{blue}{What did this show?} Here conventional methods of suppressing BBU \cite{tennant2004methods} in an ERL, such as HOM dampeners, are explored as well as accelerator optics based solutions \cite{rand1980beam}. 

Recently BBU studies have been performed for the CBETA ERL \cite{lou2019beam}, one of the main accelerators of interest within this work, which have predicted a restrictive average beam current limitation of $I_{\mathrm{th}} = 40$~\si{\milli\ampere}. However, mitigation of regenerative BBU remains an active field exemplified by the proposal of a bunch filling pattern which could increase the threshold current limitation by up to a factor of 5 for a 3-turn ERL \cite{setiniyaz2021filling}.    

\end{document}